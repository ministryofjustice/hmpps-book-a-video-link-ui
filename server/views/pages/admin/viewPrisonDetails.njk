{% extends "partials/layout.njk" %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/tag/macro.njk" import govukTag %}

{% set backLinkText = "Back" %}
{% set backLinkHref = "/admin" %}

{% set pageTitle = "Manage prison details" %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            <h1 class="govuk-heading-l">{{ pageTitle }}</h1>
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
            <p class="govuk-body">Showing <span class="govuk-!-font-weight-bold">{{ prisons | length }}</span> prisons</p>
            <p class="govuk-body">
                {% set rows = [] %}

                {% for result in prisons %}

                {% set choosePrisonHtml %}
                    <a href="/admin/edit-prison-details/{{ result.code }}" class="govuk-link govuk-link--no-visited-state" data-qa="manage-prison-link-{{ result.code }}">Manage prison</a>
                {% endset %}

                {% set pickUpTimeTagHtml %}
                  {% if result.pickUpTime %}
                       {{ govukTag({
                           text: 'On',
                           classes: 'govuk-tag--green',
                           attributes: { "data-qa": "pick-up-time-tag" }
                       }) }}
                  {% else %}
                       {{ govukTag({
                           text: 'Off',
                           classes: 'govuk-tag--orange',
                           attributes: { "data-qa": "pick-up-time-tag" }
                       }) }}
                  {% endif %}
                {% endset %}

                {% set rows = (rows.push([
                   { text: result.name, attributes: { "data-sort-value": result.name } },
                   { text: 'Yes' if result.enabled else 'No', attributes: { "data-sort-value": result.enabled, "data-qa": "prison-enabled-" + result.code } },
                   { text: result.code, attributes: { "data-qa": "prison-code-" + result.code } },
                   { html: pickUpTimeTagHtml, attributes: { "data-qa": "prison-tag-" + result.code } },
                   { text: result.pickUpTime + ' min' if result.pickUpTime else '--', attributes: { "data-qa": "prison-time-" + result.code } },
                   { html: choosePrisonHtml }
                  ]), rows)
                %}

                {% endfor %}

                {{ govukTable({
                    attributes: {
                        'data-module': 'moj-sortable-table'
                    },
                    head: [
                        { text: "Prison", attributes: { "aria-sort": "ascending" } },
                        { text: "BVLS", attributes: { "aria-sort": "none" } },
                        { text: "Prison code" },
                        { text: "Pick-up times" },
                        { text: "Time period" },
                        { html: "Action" }
                    ],
                    rows: rows
                }) }}
            </p>
        </div>
    </div>
{% endblock %}
